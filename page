#!/usr/bin/env python3
"""Page - A minimal fullscreen single-page web browser."""

import sys
import gi

gi.require_version("Gdk", "3.0")
gi.require_version("Gtk", "3.0")
gi.require_version("WebKit2", "4.1")
from gi.repository import Gdk, Gtk, WebKit2


def main():
    if len(sys.argv) != 2:
        print(f"Usage: {sys.argv[0]} <url>", file=sys.stderr)
        sys.exit(1)

    url = sys.argv[1]
    if not url.startswith(("http://", "https://", "file://")):
        url = "https://" + url

    win = Gtk.Window()
    win.set_title("Page")
    win.connect("destroy", Gtk.main_quit)

    # fullscreen() alone is ignored by xinit (no WM to process EWMH hints).
    # Manually size to screen and remove decorations so it works with or without a WM.
    win.set_decorated(False)
    monitor = Gdk.Display.get_default().get_primary_monitor()
    if monitor is not None:
        geo = monitor.get_geometry()
        win.move(geo.x, geo.y)
        win.set_default_size(geo.width, geo.height)
    win.fullscreen()

    webview = WebKit2.WebView()

    # Minimize resource usage
    settings = webview.get_settings()
    settings.set_enable_smooth_scrolling(False)
    settings.set_hardware_acceleration_policy(
        WebKit2.HardwareAccelerationPolicy.NEVER
    )

    webview.load_uri(url)
    win.add(webview)
    win.show_all()
    Gtk.main()


if __name__ == "__main__":
    main()
